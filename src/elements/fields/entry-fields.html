<link rel="import" href="../../../bower_components/polymer/polymer-element.html">

<link rel="import" href="../../styles/shared.html">

<link rel="lazy-import" href="single-field.html">
<link rel="lazy-import" href="multi-field.html">

<link rel="import" href="../../backend/notes/note.html">

<dom-module id="entry-fields">
  <template>
    <style include="shared-styles"></style>

    <backend-note note="{{note}}"></backend-note>

    <div id="fields" class="card">
      <!--
      <single-field id="noc" label="Name of Caller" entry="{{noc}}" on-entry-changed="updateNOC"></single-field>
      <single-field id="noa" label="Name on the Account" entry="{{entries.1}}"></single-field>
      <single-field id="btn" label="Billing Telephone Number" entry="{{entries.2}}"></single-field>
      <single-field id="cbn" label="Callback Number" entry="{{entries[0]}}"></single-field>
      <single-field id="msp" label="Support Level" entry="{{entries[0]}}"></single-field>
      <single-field id="ver" label="Verification Method" entry="{{ver}}"></single-field>
      <single-field id="rx" label="RX Number" entry="{{rx}}"></single-field>
      <single-field id="order" label="Order Number" entry="{{order}}"></single-field>
      <single-field id="lmir" label="LMIR Code" entry="{{lmir}}"></single-field>
      <single-field id="vtr" label="VTR Code" entry="{{vtr}}"></single-field>
      <multi-field id="info" label="Computer Info" entry="{{info}}" rows=4></multi-field>
      <multi-field id="issue" label="Issue" entry="{{issue}}" rows=4></multi-field>
      <multi-field id="ts" label="Troubleshooting" entry="{{ts}}" rows=4></multi-field>
      <multi-field id="todo" label="Todo" entry="{{todo}}" rows=4></multi-field>
      <multi-field id="res" label="Resolution" entry="{{res}}" rows=2></multi-field>
      -->
    </div>
  </template>

  <script>
    class EntryFields extends Polymer.Element {
      static get is() {
        return 'entry-fields';
      }

      static get properties() {
        return {
          fields: {
            type: Array,
            value: function () { return [] }
          },
          note: {
            type: Object,
            notify: true,
            observer: "updateFields"
          }
        };
      }

      ready() {
        super.ready();
        this.createField("noc", "Name of Caller", true);
      }

      createField(key, label, tab = false, rows = 1, reference = this) {
        var field = document.createElement(rows == 1 ? "single-field" : "multi-field");
        field.id = key;
        field.label = label;
        field.entry = this.note[field.id];
        if (rows > 1) field.rows = rows;
        field.addEventListener("entry-changed", function () {
          reference.set('note.' + field.id, field.entry);
          if (tab) document.dispatchEvent(new CustomEvent('update-tab', { detail: { name: field.entry }}));
        });
        this.$.fields.appendChild(field);
        this.push("fields", field);
      }

      updateFields() {
        this.fields.forEach(field => {
          field.entry = this.note[field.id];
        });
      }

      enableAllFields() {
        this.fields.forEach(field => {
          field.enable();
        });
      }

      disableUnrelatedFields(isp) {
        var listToDisable = [];

        this.fields.forEach(field => {
          if (!isp.fields.includes(field.id)) listToDisable.push(field);
        });

        listToDisable.forEach(field => {
          field.value = "";
          field.setAttribute('style', 'display: none');
        });
      }
    }

    window.customElements.define(EntryFields.is, EntryFields);
  </script>
</dom-module>